pipeline {
    agent any
    environment {
        // Define environment variables here
        JAVA_HOME = "/usr/lib/jvm/java-17-openjdk-amd64"
    }
    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }
        stage('SonarQube Analysis') {
            steps {
                // Use withCredentials to inject the token securely
                withCredentials([string(credentialsId: 'sonarqube', variable: 'SONARQUBE_TOKEN')]) {
                    // Use withSonarQubeEnv to set up the SonarQube environment
                    withSonarQubeEnv('sonarqube') {
                        script {
                            // Adjusting the PATH to use Java 17 explicitly
                            sh "export PATH=$JAVA_HOME/bin:$PATH && /sonar-scanner-4.6.2.2472-linux/bin/sonar-scanner \\
                            -Dsonar.projectKey=jenkinstest \\
                            -Dsonar.sources=. \\
                            -Dsonar.host.url=http://138.197.229.67:9000 \\
                            -Dsonar.login=$SONARQUBE_TOKEN"
                        }
                    }
                }
            }
        }
    }
}
